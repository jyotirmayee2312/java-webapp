version: 0.2

env:
  variables:
    AWS_DEFAULT_REGION: "us-east-1"
    AWS_ACCOUNT_ID: "YOUR_AWS_ACCOUNT_ID"
    ECR_REPO_URI: "public.ecr.aws/u3s1n7x0"

phases:
  build:
    commands:
      - mvn clean package  # Build your application to generate the .war file

      # Authenticate with ECR
      - aws ecr-public get-login-password --region $AWS_DEFAULT_REGION | docker login --username AWS --password-stdin $ECR_REPO_URI

      # Build Docker image
      - docker build -t jyotimayeeparida .

      # Tag and push Docker image to ECR
      - docker tag jyotimayeeparida:latest $ECR_REPO_URI/jyotimayeeparida:latest
      - docker push $ECR_REPO_URI/jyotimayeeparida:latest

artifacts:
  files:
    - appspec.yml
    - target/*.war
